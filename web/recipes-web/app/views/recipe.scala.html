@(recipe: uk.co.recipes.api.IRecipe, categorisation: com.google.common.collect.Multiset[uk.co.recipes.api.ITag], similarities: List[uk.co.recipes.api.IRecipe])

@main("Recipe: " + recipe.getTitle() ) {
	<section id="top">
	    <div class="wrapper">
	        <h1><span class="label label-success">@recipe.getId()</span>&nbsp;@recipe.getTitle() <span class="label label-error">@recipe.getLocale()</span> <a href="/recipes/@recipe.getTitle()/fork">[F]</a></h1>
	    </div>
	</section>
	
	@if( recipe.getForkDetails() != null) {
	<p>@recipe.getForkDetails()</p>
	}
	
	<div class="btn-group">
	  <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
	    Your Rating
	    <span class="caret"></span>
	  </a>
	  <ul class="dropdown-menu">
	    <li><a href="/recipes/@recipe.getTitle()/rate/1">1/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/2">2/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/3">3/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/4">4/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/5">5/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/6">6/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/7">7/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/8">8/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/9">9/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/10">10/10</a></li>
	  </ul>
	</div>

<hr/>
<input type="hidden" id="addIngredient" />

<script>
$("#addIngredient").select2({
    placeholder: "Search for a movie",
    minimumInputLength: 2,
    ajax: { // instead of writing the function to execute the request we use Select2's convenient helper
        url: "http://localhost:9000/search/partial",
        dataType: 'jsonp',
        data: function (term, page) {
            return {
                q: term, // search term
                count: 10
            };
        },
        results: function (data, page) { // parse the results into the format expected by Select2.
            // since we are using custom formatting functions we do not need to alter remote JSON data
            return {results: data.movies};
        }
    },
    initSelection: function(element, callback) {
        // the input tag has a value attribute preloaded that points to a preselected movie's id
        // this function resolves that id attribute to an object that select2 can render
        // using its formatResult renderer - that way the movie name is shown preselected
        var id=$(element).val();
        if (id!=="") {
            $.ajax("http://api.rottentomatoes.com/api/public/v1.0/movies/"+id+".json", {
                data: {
                    apikey: "ju6z9mjyajq2djue3gbvv26t"
                },
                dataType: "jsonp"
            }).done(function(data) { callback(data); });
        }
    },
    formatResult: movieFormatResult, // omitted for brevity, see the source of this page
    formatSelection: movieFormatSelection,  // omitted for brevity, see the source of this page
    dropdownCssClass: "bigdrop", // apply css that makes the dropdown taller
    escapeMarkup: function (m) { return m; } // we do not want to escape markup since we are displaying html in results
});

function movieFormatResult(movie) {
    var markup = "<table class='movie-result'><tr>";
    if (movie.posters !== undefined && movie.posters.thumbnail !== undefined) {
        markup += "<td class='movie-image'><img src='" + movie.posters.thumbnail + "'/></td>";
    }
    markup += "<td class='movie-info'><div class='movie-title'>" + movie.title + "</div>";
    if (movie.critics_consensus !== undefined) {
        markup += "<div class='movie-synopsis'>" + movie.critics_consensus + "</div>";
    }
    else if (movie.synopsis !== undefined) {
        markup += "<div class='movie-synopsis'>" + movie.synopsis + "</div>";
    }
    markup += "</td></tr></table>"
    return markup;
}

function movieFormatSelection(movie) {
    return movie.title;
}
</script>
<hr/>

	<ol>
	@for(item <- recipe.getItems()) {
	<li><a href="http://localhost:9000/items/@item.getCanonicalName()">@item.getCanonicalName()</a>&nbsp;@for(tagName <- item.getTagNamesForDisplay()){&nbsp;<span class="label label-info"><a href="/tags/@tagName">@tagName</a></span>}&nbsp;<a href="/recipes/@recipe.getTitle()/@item.getCanonicalName()/remove">[x]</a></li>
	}
	</ol>
	
	<hr />
	<p><span class="label label-default">Created:</span> @recipe.getCreationTime() </p>
	<p><span class="label label-default">Categorisation:</span> @categorisation</p>

	<!-- Explorer Filter Stuff starts -->
	<div class="btn-group">
	  <a class="btn btn-success dropdown-toggle" data-toggle="dropdown" href="#">
	    Must Include
	    <span class="caret"></span>
	  </a>
	  <ul class="dropdown-menu">
		@for( eachTag <- controllers.Application.allTags().iterator) {<li><a href="#" onclick="addInclTag('@eachTag')">@eachTag</a></li>}
	  </ul>
	</div>
	<div class="btn-group">
	  <a class="btn btn-warning dropdown-toggle" data-toggle="dropdown" href="#">
	    Must Exclude
	    <span class="caret"></span>
	  </a>
	  <ul class="dropdown-menu">
		@for( eachTag <- controllers.Application.allTags().iterator) {<li><a href="#" onclick="addExclTag('@eachTag')">@eachTag</a></li>}
	  </ul>
	</div>
	<button class="btn btn-danger" type="button" onclick="clearFilters()">Clear All</button>

<script>
function addInclTag(inTag) {
    $.post("/user/filter/inc/addTag=" + inTag, function(data) { location.reload(false); });
}
function addExclTag(inTag) {
    $.post("/user/filter/exc/addTag=" + inTag, function(data) { location.reload(false); });
}
function clearFilters() {
    $.post("/user/filter/clearAll", function(data) { location.reload(false); });
}</script>
	<!-- Explorer Filter Stuff ends -->

	<p>Similar Recipes:</p>
	
	<div class="container-fluid">
	
	@for(( eachRecipe, index) <- similarities.zipWithIndex) {
	
	@if((index % 3) == 0) {
		@if( index >= 3) {
		  </div>  <!-- <div class="row-fluid"> -->
		}
	 <div class="row-fluid">
	}
	
	<div class="span4">
	  <div class="hero-unit"><a href="/recipes/@eachRecipe.getTitle()">@eachRecipe.getTitle()</a> <a href="/recipes/@eachRecipe.getTitle()/fork">[F]   <a id="toggle_@index" class="btn" href="#"><i class="icon-chevron-down"></i></a></div>
	  	<div style="display: none" id="ingredients_@index"><ol>
	@for(item <- eachRecipe.getItems()) {
	<li><a href="http://localhost:9000/items/@item.getCanonicalName()">@item.getCanonicalName()</a>&nbsp;@for(tagName <- item.getTagNamesForDisplay()){&nbsp;<span class="label label-info"><a href="/tags/@tagName">@tagName</a></span>}</li>
	}
	  	</ol></div>
	</div>  <!-- <div class="span4"> -->
	
	<script>
	$('#toggle_@index').click(function() {
	  $('#ingredients_@index').slideToggle(function() {
	    // Should toggle chevron
	  });
	});
	</script>
	
	}
	
	</div>  <!-- <div class="container-fluid"> -->
}