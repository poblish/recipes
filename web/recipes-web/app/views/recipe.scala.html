@(recipe: uk.co.recipes.api.IRecipe, categorisation: com.google.common.collect.Multiset[uk.co.recipes.api.ITag], similarities: List[uk.co.recipes.api.IRecipe], recommendedItems: List[uk.co.recipes.api.ICanonicalItem])

@main("Recipe: " + recipe.getTitle() ) {
	<section id="top">
	    <div class="wrapper">
	        <h1><!-- <span>@recipe.getId()</span>&nbsp; -->@recipe.getTitle()&nbsp;<!-- <span class="label label-warning">@recipe.getLocale()</span> --><a onclick="getForkName('@recipe.getTitle()')" href="#">[F]</a></h1>
	    </div>
	</section>
	
	@if( recipe.getForkDetails() != null) {
	<p>@recipe.getForkDetails()</p>
	}
	
	<div class="btn-group" style="margin: 6px 0 12px 0">
	  <a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#">
	    Your Rating
	    <span class="caret"></span>
	  </a>
	  <ul class="dropdown-menu">
	    <li><a href="/recipes/@recipe.getTitle()/rate/1">1/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/2">2/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/3">3/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/4">4/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/5">5/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/6">6/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/7">7/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/8">8/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/9">9/10</a></li>
	    <li><a href="/recipes/@recipe.getTitle()/rate/10">10/10</a></li>
	  </ul>
	</div>

	<!-- Explorer Filter Stuff starts -->
	<div class="btn-group">
	  <a class="btn btn-success dropdown-toggle" data-toggle="dropdown" href="#">
	    Must Include
	    <span class="caret"></span>
	  </a>
	  <ul class="dropdown-menu">
		@for( eachTag <- controllers.Application.allTags().iterator) {<li><a href="#" onclick="addInclTag('@eachTag')">@eachTag</a></li>}
	  </ul>
	</div>
	<div class="btn-group">
	  <a class="btn btn-warning dropdown-toggle" data-toggle="dropdown" href="#">
	    Must Exclude
	    <span class="caret"></span>
	  </a>
	  <ul class="dropdown-menu">
		@for( eachTag <- controllers.Application.allTags().iterator) {<li><a href="#" onclick="addExclTag('@eachTag')">@eachTag</a></li>}
	  </ul>
	</div>
	<button class="btn btn-danger" type="button" onclick="clearFilters()">Clear All</button>

	<div style="margin-top: 15px"><input type="hidden" style="width: 250px" id="addIngredient" /></div><button type="button" class="btn btn-default" onclick="addIngredient('@recipe.getTitle()',$('#addIngredient'))">Add Ingredient</button>
	<hr/>

	<!-- Explorer Filter Stuff ends -->

	<div class="row">
	  <div class="col-md-3">

		<div class="panel-group" id="accordion">
		  <div class="panel panel-default">
		    <div class="panel-heading">
		      <h4 class="panel-title">
		        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse1">
		          Ingredients:
		        </a>
		      </h4>
		    </div>
		    <div id="collapse1" class="panel-collapse collapse in">
		      <div class="panel-body">
				<ul class="list-group">
				@for(ingr <- recipe.getSortedIngredients()) {
				<li class="list-group-item"><a href="http://localhost:9000/items/@ingr.getItem().getCanonicalName()">@ingr.getItem().getCanonicalName()</a>&nbsp;@if(ingr.isOptional()) { <span>(optional)</span>&nbsp;}@for(tagName <- ingr.getItem().getTagNamesForDisplay()){&nbsp;<span class="label @uk.co.recipes.tags.TagUtils.getStyle(tagName)"><a href="/tags/@tagName">@tagName</a></span>}&nbsp;<a href="/recipes/@recipe.getTitle()/@ingr.getItem().getCanonicalName()/remove">[x]</a></li>
				}
				</ul>
		      </div>
		    </div>
		  </div>
		  <div class="panel panel-default">
		    <div class="panel-heading">
		      <h4 class="panel-title">
		        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse2">
		          Categories:
		        </a>
		      </h4>
		    </div>
		    <div id="collapse2" class="panel-collapse collapse">
		      <div class="panel-body">
				@categorisation
		      </div>
		    </div>
		  </div>
		  <div class="panel panel-default">
		    <div class="panel-heading">
		      <h4 class="panel-title">
		        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse3">
		          Details:
		        </a>
		      </h4>
		    </div>
		    <div id="collapse3" class="panel-collapse collapse">
		      <div class="panel-body">
				Created by <a href="http://localhost:9000/users/@recipe.getCreator().getUserName()">@recipe.getCreator().getDisplayName()</a> on @org.joda.time.format.DateTimeFormat.forPattern("dd MMMM yyyy 'at' HH:mm").withLocale( Locale.UK ).print( recipe.getCreationTime() )
		      </div>
		    </div>
		  </div>
		</div>

	  </div>
	  <div class="col-md-9">
		@if( recommendedItems.size() == 0) {
			<p>Sorry, no Ingredient suggestions</p>
		} else {
			<div class="container">
			<h3>Why not add?</h3>
			@for(( eachItem, index) <- recommendedItems.zipWithIndex) {
	
			@if((index % 3) == 0) {
				@if( index >= 3) {
				  </div>  <!-- <div class="row"> -->
				}
			 <div class="row">
			}
	
			<div class="col-md-4">
				<div class="well"><a href="http://localhost:9000/items/@eachItem.getCanonicalName()">@eachItem.getCanonicalName()</a>&nbsp;@for(tagName <- eachItem.getTagNamesForDisplay()){&nbsp;<span class="label @uk.co.recipes.tags.TagUtils.getStyle(tagName)"><a href="/tags/@tagName">@tagName</a></span>}</div>
			</div>  <!-- <div class="col-md-4"> -->		
			}

			</div>  <!-- <div class="row"> -->
			</div>  <!-- <div class="container"> -->
		}

		@if( similarities.size() == 0) {
			<p>Sorry, no Similar recipes could be found</p>
		} else {
			<div class="container">
			<h3>Similar Recipes:</h3>
			@for(( eachRecipe, index) <- similarities.zipWithIndex) {
			
			@if((index % 3) == 0) {
				@if( index >= 3) {
				  </div>  <!-- <div class="row"> -->
				}
			 <div class="row">
			}
	
			<div class="col-md-4">
				@_displayRecipe( eachRecipe, index)
			</div>  <!-- <div class="col-md-4"> -->
			
			<script>
			$('#toggle_@index').click(function() {
			  $('#ingredients_@index').slideToggle(function() {
			    // Should toggle chevron
			  });
			});
			</script>
			
			}
			
			</div>  <!-- <div class="row"> -->
			</div>  <!-- <div class="container"> -->
		}
	  </div>  <!-- <div class="col-md-9"> -->
	</div>  <!-- <div class="row"> -->

<script>
function addInclTag(inTag) {
    $.post("/user/filter/inc/addTag=" + inTag, function(data) { location.reload(false); });
}
function addExclTag(inTag) {
    $.post("/user/filter/exc/addTag=" + inTag, function(data) { location.reload(false); });
}
function clearFilters() {
    $.post("/user/filter/clearAll", function(data) { location.reload(false); });
}

$("#addIngredient").select2({
    placeholder: "Find Ingredient...",
    minimumInputLength: 2,
    ajax: { // instead of writing the function to execute the request we use Select2's convenient helper
        url: "http://localhost:9000/search/partial",
        dataType: 'jsonp',
        data: function (term, page) {
            return {
                q: term, // search term
                count: 10
            };
        },
        results: function (data, page) { // parse the results into the format expected by Select2.
            // since we are using custom formatting functions we do not need to alter remote JSON data
            return {results: data};
        }
    },
    initSelection: function(element, callback) {
        // the input tag has a value attribute preloaded that points to a preselected movie's id
        // this function resolves that id attribute to an object that select2 can render
        // using its formatResult renderer - that way the movie name is shown preselected
        var id=$(element).val();
        if (id!=="") {
            $.ajax("http://api.rottentomatoes.com/api/public/v1.0/movies/"+id+".json", {
                data: {
                    apikey: "ju6z9mjyajq2djue3gbvv26t"
                },
                dataType: "jsonp"
            }).done(function(data) { callback(data); });
        }
    },
    formatResult: doFormatResult,
    formatSelection: doFormatSelection,
    dropdownCssClass: "bigdrop", // apply css that makes the dropdown taller
    escapeMarkup: function (m) { return m; } // we do not want to escape markup since we are displaying html in results
});

function doFormatResult(inRec) {
	/* if (inRec.type === 'item') ... */
	return inRec.displayName;
}

function doFormatSelection(inRec) {
    return inRec.displayName;  // FIXME What is this?
}
</script>
}